<!DOCTYPE html>
<html>
<head>
    <title>CogOS Chat Interface</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #chat-container { border: 1px solid #ccc; height: 400px; overflow-y: scroll; padding: 10px; }
        #input-container { margin-top: 10px; }
        #message-input { width: 70%; padding: 10px; }
        #send-button { padding: 10px 20px; }
    </style>
</head>
<body>
<div id="api-setup" style="background: #f0f0f0; padding: 10px; margin-bottom: 20px;">
    <h3>API Configuration</h3>
    <input type="password" id="claude-key" placeholder="Claude API Key (sk-ant-...)" style="width: 300px; margin: 5px;">
    <input type="password" id="deepseek-key" placeholder="DeepSeek API Key" style="width: 300px; margin: 5px;">
    <select id="default-model" style="margin: 5px;">
        <option value="claude">Claude (paid, best quality)</option>
        <option value="deepseek">DeepSeek (free, good for analysis)</option>
    </select>
    <button onclick="saveKeys()">Save Keys</button>
    <button onclick="clearKeys()">Clear Keys</button>
    <div id="key-status"></div>
</div>
    <h1>CogOS - Cognitive Operating System</h1>
    <div id="chat-container"></div>
    <div id="input-container">
        <input type="text" id="message-input" placeholder="Enter your message...">
        <button id="send-button">Send</button>
    </div>
    
<script>
const chatContainer = document.getElementById('chat-container');
const messageInput = document.getElementById('message-input');
const sendButton = document.getElementById('send-button');
    // API Key management
function saveKeys() {
    const claudeKey = document.getElementById('claude-key').value;
    const deepseekKey = document.getElementById('deepseek-key').value;
    
    if (claudeKey) localStorage.setItem('claude-api-key', claudeKey);
    if (deepseekKey) localStorage.setItem('deepseek-api-key', deepseekKey);
    
    document.getElementById('key-status').innerHTML = '<span style="color: green;">Keys saved locally</span>';
    loadSavedKeys();
}

function clearKeys() {
    localStorage.removeItem('claude-api-key');
    localStorage.removeItem('deepseek-api-key');
    document.getElementById('key-status').innerHTML = '<span style="color: red;">Keys cleared</span>';
    document.getElementById('claude-key').value = '';
    document.getElementById('deepseek-key').value = '';
}

function loadSavedKeys() {
    const claudeKey = localStorage.getItem('claude-api-key');
    const deepseekKey = localStorage.getItem('deepseek-api-key');
    
    if (claudeKey) document.getElementById('claude-key').value = 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢';
    if (deepseekKey) document.getElementById('deepseek-key').value = 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢';
}

// Call this when page loads
window.onload = function() {
    loadSavedKeys();
};
// AI API Functions
async function callClaude(message, systemPrompt) {
    const apiKey = localStorage.getItem('claude-api-key');
    if (!apiKey) {
        throw new Error('Claude API key not found');
    }
    
    const response = await fetch('https://api.anthropic.com/v1/messages', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'x-api-key': apiKey,
            'anthropic-version': '2023-06-01'
        },
        body: JSON.stringify({
            model: 'claude-3-5-sonnet-20241022',
            max_tokens: 1000,
            system: systemPrompt,
            messages: [{ role: 'user', content: message }]
        })
    });
    
    if (!response.ok) {
        throw new Error(`Claude API error: ${response.status}`);
    }
    
    const data = await response.json();
    return data.content[0].text;
}

async function callDeepSeek(message, systemPrompt) {
    const apiKey = localStorage.getItem('deepseek-api-key');
    if (!apiKey) {
        throw new Error('DeepSeek API key not found');
    }
    
    const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${apiKey}`
        },
        body: JSON.stringify({
            model: 'deepseek-chat',
            messages: [
                { role: 'system', content: systemPrompt },
                { role: 'user', content: message }
            ]
        })
    });
    
    if (!response.ok) {
        throw new Error(`DeepSeek API error: ${response.status}`);
    }
    
    const data = await response.json();
    return data.choices[0].message.content;
}
// CogOS Core - auto-injected
const cogosCore = `### COGNITIVE OS v2.4 - CORE KERNEL
Prime Directive: Uncover insights unreachable individually.

Core Pact:
1. Truth > Comfort. Novelty > Convention. Depth > Speed.
2. Unprotected Exploration > Defensive Certainty.
[... rest of your core OS ...]`;

// Module storage
const modules = {
    pump: `### !PUMP [topic]
Generate novel, confidence-tagged hypotheses...`,
    drill: `### !DRILL [concept]
Recursively analyze concept to foundational assumptions...`,
    // Add other modules as needed
};

// Add message to chat
function addMessage(sender, message) {
    const messageDiv = document.createElement('div');
    messageDiv.innerHTML = `<strong>${sender}:</strong> ${message}`;
    chatContainer.appendChild(messageDiv);
    chatContainer.scrollTop = chatContainer.scrollHeight;
}

// Check if message contains module triggers
function checkForModules(message) {
    let activeModules = [];
    if (message.includes('!pump')) activeModules.push(modules.pump);
    if (message.includes('!drill')) activeModules.push(modules.drill);
    return activeModules;
}

// Send message function
async function sendMessage() {
    const message = messageInput.value.trim();
    if (!message) return;
    
    addMessage('You', message);
    messageInput.value = '';
    
    // Show thinking indicator
    addMessage('CogOS', 'ðŸ¤” Processing...');
    
    try {
        // Check for active modules
        const activeModules = checkForModules(message);
        
        // Build system prompt with CogOS + active modules
        let systemPrompt = cogosCore;
        if (activeModules.length > 0) {
            systemPrompt += '\n\n' + activeModules.join('\n\n');
        }
        
        // Choose model (default to Claude for now)
        const defaultModel = document.getElementById('default-model').value;
        let response;
        
        if (defaultModel === 'claude') {
            response = await callClaude(message, systemPrompt);
        } else {
            response = await callDeepSeek(message, systemPrompt);
        }
        
        // Remove thinking indicator and add real response
        chatContainer.removeChild(chatContainer.lastChild);
        addMessage('AI', response);
        
    } catch (error) {
        // Remove thinking indicator and show error
        chatContainer.removeChild(chatContainer.lastChild);
        addMessage('Error', `Failed to get response: ${error.message}`);
    }
}

// Event listeners
sendButton.addEventListener('click', sendMessage);
messageInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') sendMessage();
});

// Initialize
addMessage('CogOS', 'Cognitive Operating System initialized. Ready for collaboration.');
</script>
</body>
</html>
